sequenceDiagram
    participant D1 as Device A
    participant D2 as Device B
    participant API as KoroMind API
    participant DB as Database
    participant W as Worker

    Note over D1,W: Device A starts session
    D1->>API: Connect with PIN
    API->>DB: Check active sessions
    DB-->>API: No active session
    API->>DB: Create session locked to Device A
    API->>W: Assign worker
    API-->>D1: Session started

    Note over D1,W: Device A sends message
    D1->>API: Message + session_id
    API->>DB: Validate session ownership
    API->>W: Process message
    W-->>D1: Response

    Note over D2,W: Device B tries to connect
    D2->>API: Connect same user different device
    API->>DB: Check active sessions
    DB-->>API: Active session on Device A
    API->>D1: Force disconnect notification
    API->>DB: Transfer session to Device B
    API->>W: Reassign worker
    API-->>D2: Session started and took over
