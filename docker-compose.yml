# TORIS Claude Voice Assistant - Docker Compose
#
# Quick start:
#   cp docker/toris.env.example docker/toris.env
#   # Edit docker/toris.env with your API keys
#   docker-compose up -d
#
# Logs:
#   docker-compose logs -f toris
#
# Authentication options:
#   1. API Key: Set ANTHROPIC_API_KEY in docker/toris.env
#   2. Subscription: Uncomment the credentials mount below after running 'claude /login' on host

services:
  toris:
    build: .
    container_name: claude-voice-toris
    env_file:
      - docker/toris.env
    volumes:
      # Persistent state (session history, user settings)
      - toris-state:/home/claude/state
      # Sandbox for Claude file operations
      - toris-sandbox:/home/claude/sandbox
      # Prompts directory (read-only)
      - ./prompts:/home/claude/app/prompts:ro
      # Claude credentials persistence
      - toris-claude-config:/home/claude/.claude
      # OPTIONAL: Mount host credentials for subscription users
      # Uncomment after running 'claude /login' on your host machine
      # - ~/.claude/.credentials.json:/home/claude/.claude/.credentials.json:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "pgrep", "-f", "python.*bot.py"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  toris-state:
  toris-sandbox:
  toris-claude-config:
